<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel ="stylesheet" type="text/css" href="main.css">
    <script src="jquery.simplemodal.1.4.4.min.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('<button type="button" id ="button">Refresh Tweets</button>');

        var index = streams.home.length - 1;
        var beginningIndex = index; 
        var displayTweets = function(whereToPut) {
          var $tweet = $('<div class="post"></div>');
          $tweet.html('@' + '<span class="username">'+tweet.user +'</span>' + ': ' + tweet.message);
          if (whereToPut === 'appendTo') {
            $tweet.appendTo($body);
          } else {
            $tweet.prependTo($body);
          }
          var $timeStamp = $('<ul class="time"><li></li></ul>');
          $timeStamp.text('Posted on: ' + tweet.created_at);
          $timeStamp.appendTo($tweet);
        }
        while(index >= 0){
          var tweet = streams.home[index];
          displayTweets('appendTo');
          index -= 1;
        }
        
        $('#button').on("click", function(){
          var newIndex = streams.home.length -1;
          while (newIndex > beginningIndex) {
            var tweet = streams.home[newIndex];
            displayTweets('prependTo');
            newIndex -= 1;
          }
          beginningIndex = streams.home.length -1;
        });
        $(".username").on ('click', function(){
          var userId = $(this).text();
          var userStream = streams.users[userId];
          var $allTweets = $('<div class="modalTweet"></div>');
          $.each(userStream, function(i, value) {
            var $eachTweet = $('<section></section>');
            $eachTweet.html('<p class="message">' + value.message+ '</p>' + '<p class ="time">'+ value.created_at + '</p>');
            $eachTweet.appendTo($allTweets); 
            // console.log(value.message + " " + value.created_at);
          });
          $allTweets.modal();
        });
      });

    </script>
  </body>
</html>
